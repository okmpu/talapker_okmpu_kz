{% load i18n %}

<div 
    id="drawer-top-navbar"
    class="fixed top-0 left-0 right-0 z-40 w-full p-4 transition-transform -translate-y-full bg-white"
    tabindex="-1" 
    aria-labelledby="drawer-top-label"
>
    <button 
        type="button" 
        data-drawer-hide="drawer-top-navbar" 
        aria-controls="drawer-top-navbar"
        class="bg-transparent hover:bg-secondary-200 rounded-lg w-8 h-8 absolute top-2.5 end-2.5 inline-flex items-center justify-center"
    >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-icon lucide-x">
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
        </svg>
    </button>

    <div class="mt-8">
        <nav class="grid gap-2">
            <div class="flex gap-2">
                <form class="w-full flex-1" action="" method="get">   
                    <div class="relative">
                        <input 
                            type="search" 
                            id="search-search" 
                            name="query" 
                            class="block w-full px-3 py-2 border border-border-300 rounded-lg focus:ring-primary-600 focus:border-primary-600" 
                            placeholder="Іздеу..." 
                            required 
                        />
                        <button 
                            type="submit" 
                            class="rounded-lg p-2 absolute end-2 bottom-[3px] right-1 focus:ring-4 focus:outline-none focus:ring-secondary-300"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search">
                                <path d="m21 21-4.34-4.34" />
                                <circle cx="11" cy="11" r="8" />
                            </svg>
                        </button>
                    </div>
                </form>

                <form action="{% url 'set_language' %}" method="post" class="flex items-center space-x-4">
                    {% csrf_token %}
                    <div class="relative w-full">
                        <select 
                            name="language" 
                            onchange="this.form.submit()" 
                            class="block w-full py-2 px-4 border border-border-200 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-primary-600"
                        >
                            {% get_current_language as LANGUAGE_CODE %}
                            {% get_available_languages as LANGUAGES %}
                            {% get_language_info_list for LANGUAGES as languages %}
                            {% for language in languages %}
                                <option value="{{ language.code }}" {% if language.code == LANGUAGE_CODE %}selected{% endif %}>
                                    {{ language.name_local }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <input type="hidden" name="next" value="{{ request.path }}">
                </form>
            </div>
            

            <a href="{% url 'main' %}" class="flex py-2 px-4 border-b border-border-200">
                {% translate 'Home page' %}
            </a>

            <div
                id="accordion-main" 
                data-accordion="collapse"
                data-inactive-classes="text-muted"
                data-active-classes="text-foreground bg-transparent font-medium"
            >
                {% for category in categories %}
                    <h2 id="accordion-heading-{{ category.id }}">
                        <button 
                            type="button"
                            class="flex gap-2 items-center justify-between w-full py-2 px-4 border-b border-border-200"
                            data-accordion-target="#accordion-body-{{ category.id }}" 
                            aria-expanded="false"
                            aria-controls="accordion-body-{{ category.id }}"
                        >
                            <span>{{ category.name }}</span>
                            {% if category.children.all %}
                                <svg 
                                    data-accordion-icon
                                    xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                                    class="lucide lucide-chevron-down shrink-0">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            {% endif %}
                        </button>
                    </h2>
                    <div 
                        id="accordion-body-{{ category.id }}" 
                        class="hidden" 
                        aria-labelledby="accordion-heading-{{ category.id }}"
                    >
                        <div class="p-2">
                            {% for sub in category.children.all %}
                                <a 
                                    href="{% if sub.category_type == 'content' %}{% url 'content_detail' category.slug sub.slug sub.slug %}{% elif sub.category_type == 'link' %}{{ sub.url }}{% endif %}"
                                    class="flex items-center gap-2 px-4 py-2 hover:bg-secondary-100"
                                    target="{% if sub.target %}_blank{% else %}_self{% endif %}"
                                >
                                    {% if sub.category_type == 'link' %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link-icon lucide-link">
                                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                                        </svg>
                                    {% endif %}
                                    <h1 class="flex-1 line-clamp-2">{{ sub.name }}</h1>
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </nav>
    </div>
</div>